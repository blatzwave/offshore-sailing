<!DOCTYPE html>
<html>
<head>
    <title>Offshore Sailing</title>
    
</head>
<body>
    <script>

        async function getBoat() {
            console.log("About to fetch boat data...");
            const response = await fetch('/api');
            const data = await response.json();
            console.log(data);
            document.getElementById("currHDG").textContent = data.hdg;
            document.getElementById("currPOS").textContent = data.lat + ", "+ data.lon;
            document.getElementById("currBSP").textContent = data.bsp;
            document.getElementById("currTWS").textContent = data.tws;
            document.getElementById("currTWD").textContent = data.twd;
        }

        const setHDG = (ev) => {
            ev.preventDefault();
            let manouver = {
                time: Date.now(),
                newHDG: document.getElementById('newHDG').value
            };
            const options = {
            method: 'POST',
            headers: {
            'Content-Type': 'application/json'
            },
            body: JSON.stringify(manouver)
            };

            fetch('/api', options)
            .then(response => response.json())
            .then(json => console.log(json)); 

            document.getElementById("currHDG").textContent = manouver.newHDG;
        };

        document.addEventListener('DOMContentLoaded', () => {
        document.getElementById('btn').addEventListener('click', setHDG);
        getBoat();
        });
    </script>
    
    <h1>Offshore Sailing</h1>
    <p>This page will display a virtual boat's position, heading and speed as well as real-time wind speed and heading sourced from an API.</p>

    <div id="boatData">
        <div>Position: <span id="currPOS"></span></div>
    <div>Heading: <span id="currHDG"></span>&deg</div>
<div>Boat speed: <span id="currBSP"></span> kts</div>
    </div><p>
    <div id="windData">
       <div>True wind direction: <span id="currTWD"></span>&deg</div> 
        <div>True wind speed: <span id="currTWS"></span> kts</div>
    </div>
    <hr>
    <div><form action=# method="POST">
        <label for="newHDG">New Heading</label>
        <input type="number" id="newHDG" min ="0" max="360">
        <button type="submit" id='btn'>Submit</button>
    </form></div>


   
 

</body>

</html>